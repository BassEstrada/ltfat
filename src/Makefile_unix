# Use GNU Make to process this file

CC=gcc

CFLAGS=-O3 -Wall -fPIC -std=c99 -m64 -I../thirdparty 
DIRECTIVES=-DCOMPILING_LTFAT -DLTFAT_DLL_NEVERUSED -DLTFAT_BACKEND_EXPORTS
#CFLAGS=-O2 -fPIC -std=c99 -I../thirdparty -L../thirdparty

include filedefs.mk

files_unix = $(addprefix d,$(allfiles)) $(addprefix s,$(allfiles)) dltfat_blaslapack.o sltfat_blaslapack.o
files_matlab = $(files) $(files_blaslapack) dltfat_blaslapack_matlab.o sltfat_blaslapack_matlab.o

all: libltfat.a

libltfat.a: $(files_unix) c-safe-memalloc.o 
	ar rvu libltfat.a $(files_unix) c-safe-memalloc.o
	ranlib libltfat.a
	cp -f libltfat.a ../lib

sltfat_blaslapack_matlab.o: ltfat_blaslapack.c config.h
	$(CC) $(CFLAGS) -DLTFAT_SINGLE -DMATLABFORTRAN -c $< -o $*.o

dltfat_blaslapack_matlab.o: ltfat_blaslapack.c config.h
	$(CC) $(CFLAGS) -DLTFAT_DOUBLE -DMATLABFORTRAN -c $< -o $*.o

s%.o: %.c config.h
	$(CC) $(CFLAGS) -DLTFAT_SINGLE  -c $< -o s$*.o

d%.o: %.c config.h
	$(CC) $(CFLAGS) -DLTFAT_DOUBLE  -c $< -o d$*.o

%.o: %.c Makefile config.h
	$(CC) $(CFLAGS) $(DIRECTIVES) -DLTFAT_DOUBLE  -c $<

clean:
	-rm *.o
