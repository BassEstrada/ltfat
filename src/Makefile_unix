# Use GNU Make to process this file
#
# REAMRK: No dependency is resolved here!


CFLAGS=-O3 -fPIC -std=c99 -Ithirdparty 

include filedefs.mk

toCompile = $(files) $(files_blaslapack)

DFILES = $(addprefix d,$(toCompile)) $(files_notypechange)
SFILES = $(addprefix s,$(toCompile))

#files_unix = $(addprefix d,$(toCompile)) $(addprefix s,$(toCompile)) $(files_notypechange)
#files_matlab = $(files) $(files_blaslapack) dltfat_blaslapack_matlab.o sltfat_blaslapack_matlab.o

all: double_static single_static

double_static: $(DFILES) Makefile_unix
	ar rvu libltfat.a $(DFILES) 
	ranlib libltfat.a
	cp -f libltfat.a ../lib

single_static: $(SFILES) Makefile_unix
	ar rvu libltfatf.a $(SFILES) 
	ranlib libltfatf.a
	cp -f libltfatf.a ../lib

double_shared: $(DFILES) Makefile_unix
	$(CC) -shared $(DFILES) -o libltfat.so
	cp -f libltfat.so ../lib

single_shared: $(SFILES) Makefile_unix
	$(CC) -shared $(SFILES) -o libltfatf.so
	cp -f libltfatf.so ../lib

sltfat_blaslapack_matlab.o: ltfat_blaslapack.c config.h
	$(CC) $(CFLAGS) -DLTFAT_SINGLE -DMATLABFORTRAN -c $< -o $*.o

dltfat_blaslapack_matlab.o: ltfat_blaslapack.c config.h
	$(CC) $(CFLAGS) -DLTFAT_DOUBLE -DMATLABFORTRAN -c $< -o $*.o

s%.o: %.c config.h
	$(CC) $(CFLAGS) -DLTFAT_SINGLE  -c $< -o s$*.o

d%.o: %.c config.h
	$(CC) $(CFLAGS) -DLTFAT_DOUBLE  -c $< -o d$*.o

%.o: %.c Makefile config.h
	$(CC) $(CFLAGS) -c $<

clean:
	-rm *.o *.a
