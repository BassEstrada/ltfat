# Use MinGW Make to process this file. Y must provide your sytem system specific MATLABROOT
# variable on the command line e.g.:
#
# make -f Makefile_mingw64 MATLABROOT="C:\Program Files\MATLAB\R2011b"

ifndef MATLABROOT
  $(warning MATLABROOT variable is udefined. Using default MATLABROOT="C:\Program Files\MATLAB\R2011b" )
  MATLABROOT=C:\Program Files\MATLAB\R2011b
endif

MATLABLIBS=-lmwlapack -lmwblas
MATLABLINKFLAGS=-L"$(MATLABROOT)\bin\win64" $(MATLABLIBS)

CC=gcc

CFLAGS=-O3 -s -Wall -std=c99 -m64 -I../thirdparty -I./
DIRECTIVES=-DCOMPILING_LTFAT -DLTFAT_DLL_NEVERUSED -DMATLABFORTRAN

include filedefs.mk

DFILES = $(addprefix d,$(files)) $(addprefix d,$(files_blaslapack)) $(files_notypechange)
SFILES = $(addprefix s,$(files)) $(addprefix s,$(files_blaslapack))

all: double single

double: $(DFILES) Makefile_mingw64
	$(CC) -shared -Wl,--dll $(DFILES) \
	-o ../mex/ltfat.dll ltfat_notdllexport.def -static-libgcc -L../mex -lfftw3-3 $(MATLABLINKFLAGS)
	del *.o *.a
	copy /Y ..\mex\ltfat.dll ..\lib\
  
single: $(SFILES) Makefile_mingw64  
	$(CC) -shared -Wl,--dll $(SFILES) \
	-o ../mex/ltfatf.dll -static-libgcc -L../mex -lfftw3-3 -lfftw3f-3 -lltfat $(MATLABLINKFLAGS)
	del *.o *.a
	copy /Y ..\mex\ltfatf.dll ..\lib\

s%.o: %.c config.h
	$(CC) $(CFLAGS) $(DIRECTIVES) -DLTFAT_SINGLE  -c $< -o s$*.o

d%.o: %.c config.h
	$(CC) $(CFLAGS) $(DIRECTIVES) -DLTFAT_DOUBLE  -c $< -o d$*.o

%.o: %.c
	$(CC) $(CFLAGS) $(DIRECTIVES) -c $<

clean:
	del ..\mex\ltfat.dll
	del ..\mex\ltfatf.dll
	del *.o *.a
