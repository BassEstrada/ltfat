# Use GNU Make to process this file
MATLABROOT=C:\Program Files\MATLAB\R2011b
MATLABLIBS=-lmwlapack -lmwblas
MATLABLINKFLAGS=-L"$(MATLABROOT)\bin\win64" $(MATLABLIBS)

#CC = i686-pc-mingw32-gcc 
CC=gcc

CFLAGS=-O3 -s -Wall -std=c99 -m64 -I../thirdparty -I./
DIRECTIVES=-DCOMPILING_LTFAT -DLTFAT_DLL_NEVERUSED -D_WIN32 -D_WINDOWS -D_USRDLL -DLTFAT_BACKEND_EXPORTS

include filedefs.mk

FILESBASE  = $(basename $(toCompile))
FILESBASEO = $(addsuffix .o,$(FILESBASE))
DFILES = $(addprefix d,$(FILESBASEO))
SFILES = $(addprefix s,$(FILESBASEO))


all: double single

double: $(DFILES) $(toCompileNoType)
	$(CC) -shared -Wl,--dll $(DFILES) $(toCompileNoType) \
	-o ../mex/ltfat.dll -static-libgcc ltfat_notdllexport.def -L../mex -lfftw3-3
	del *.o *.a
  
single: $(SFILES)  
	$(CC) -shared -Wl,--dll $(SFILES) \
	-o ../mex/ltfatf.dll -static-libgcc -L../mex -lfftw3-3 -lfftw3f-3
	del *.o *.a

s%.o: %.c config.h
	$(CC) $(CFLAGS) $(DIRECTIVES) -DLTFAT_SINGLE  -c $< -o s$*.o

d%.o: %.c config.h
	$(CC) $(CFLAGS) $(DIRECTIVES) -DLTFAT_DOUBLE  -c $< -o d$*.o

%.o: %.c
	$(CC) $(CFLAGS) $(DIRECTIVES) -c $<

clean:
	del ..\mex\ltfat.dll
	del ..\mex\ltfatf.dll
	del *.o *.a
