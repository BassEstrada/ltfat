# To run this makefile, you must provide the EXT and MATLABROOT
# variables on the command line, i.e. as in
#
# make -f Makefile_unix MATLABROOT="C:\Program Files\MATLAB\R2011b"  EXT=mexw64

CC=gcc
CFLAGS=-shared -O3 -Wall -s -std=c99 -m64 -I../thirdparty -I../src

include filedefs.mk

MEXS     = $(addsuffix .$(EXT),$(MEXSBASE))

MEXCOMPFLAGS=-I"$(MATLABROOT)\extern\include"
MEXLIBS=-lmex -lmx
MEXLINKFLAGS=-static-libgcc mex.def -L"$(MATLABROOT)\bin\win64" $(MEXLIBS)


all: $(MEXS)

%.$(EXT): %.c 
	echo EXPORTS > mex.def & echo mexFunction >> mex.def 
	$(CC) $(CFLAGS) $(MEXCOMPFLAGS) $< -o $@ -L./ -lltfat -lltfatf -lfftw3-3 -lfftw3f-3 $(MEXLINKFLAGS)
	del mex.def 

clean:
	del *.$(EXT)

.PHONY: all clean
