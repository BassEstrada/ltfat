# To run this makefile, you must provide the EXT and MATLABROOT
# variables on the command line, i.e. as in
#
# make -f Makefile_unix MATLABROOT=/usr/local/MATLAB/R2011a  EXT=$(mexext)

ifndef MATLABROOT
  $(warning MATLABROOT variable is udefined. Using default MATLABROOT="/usr/local/MATLAB/R2011a/")
  MATLABROOT=/usr/local/MATLAB/R2011a/
endif

ifndef EXT
  $(warning EXT variable is udefined. Using default EXT=mexa64)
  EXT=mexa64
endif

ifndef ARCH
	$(warning ARCH not set. Using default ARCH=glnxa64)
	ARCH=glnxa64
endif

CFLAGS=-shared -O3 -Wall -fPIC -std=c99 -I../src/thirdparty -I../src -I"$(MATLABROOT)/extern/include" -fvisibility=hidden
LIBFLAGS= -lfftw3 -lfftw3f -lblas -llapack -L../lib -lltfat -lltfatf -L"$(MATLABROOT)/bin/$(ARCH)" -lmex -lmx -lmat 
RPATH=-Wl,-rpath-link,"$(MATLABROOT)/bin/$(ARCH)"

include filedefs.mk

MEXBASE = $(MEXBASESAFE) $(MEXBASEMORE) 
MEXS     = $(addsuffix .$(EXT),$(MEXBASE))

all: $(MEXS) 

$(MEXS): %.$(EXT): %.c Makefile config.h ../lib/libltfat.a ../src/ltfat.h
	$(CC) $(CFLAGS) $< -o $@ $(RPATH) $(LIBFLAGS) 

clean:
	-rm *.$(EXT)

.PHONY: all clean
